(function(){(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.4";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?null:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return 0===b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=++H+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(K,function(a){return"\\"+J[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",function(a){return function(){var b;return b||a._}}(this)),"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return jQuery}),!function(a){function b(b,c,d){var e=b[c];e&&(b[c]=function(){return arguments[d]=arguments[d].replace(/@([\w\u00c0-\uFFFF\-]+)/g,'[role~="$1"]'),e.apply(b,arguments)},a.extend(b[c],e))}function c(b,c){for(var d,e=[],f=a.trim(b).split(/\s+/),g=0;g<f.length;g++)d=f[g],~a.inArray(d,e)||c&&~a.inArray(d,c)||e.push(d);return e}b(a,"find",0),b(a,"multiFilter",0),b(a.find,"matchesSelector",1),b(a.find,"matches",0),a.extend(a.fn,{roles:function(){return c(this.attr("role"))},hasRole:function(a){for(var b=c(a),d=0;d<b.length;d++)if(!this.is("@"+b[d]))return!1;return!0},addRole:function(b){return this.hasRole(b)?this:this.each(function(d,e){var f=a(e);f.attr("role",c(f.attr("role")+" "+b).join(" "))})},removeRole:function(b){return this.hasRole(b)?this.each(function(d,e){var f=a(e);f.attr("role",c(f.attr("role"),c(b)).join(" "))}):this},toggleRole:function(a){for(var b=c(a),d=0;d<b.length;d++)this[this.hasRole(b[d])?"removeRole":"addRole"].call(this,b[d]);return this}})}(jQuery),define("jquery.role",function(){}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("spin",b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):void(this.opts=f(a||{},i.defaults,o))}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function s(){m++;for(var a=0;a<h.lines;a++)l=Math.max(1-(m+(h.lines-a)*r)%p*q,h.opacity),f.opacity(i,a*h.direction+n,l,h);f.timeout=f.el&&setTimeout(s,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i}),function(a){if("object"==typeof exports)a(require("jquery"),require("spin"));else if("function"==typeof define&&define.amd)define("jquery.spin",["jquery","spin"],a);else{if(!window.Spinner)throw new Error("Spin.js not present");a(window.jQuery,window.Spinner)}}(function(a,b){a.fn.spin=function(c,d){return this.each(function(){var e=a(this),f=e.data();f.spinner&&(f.spinner.stop(),delete f.spinner),c!==!1&&(c=a.extend({color:d||e.css("color")},a.fn.spin.presets[c]||c),f.spinner=new b(c).spin(this))})},a.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}}),function(a){"function"==typeof define&&define.amd?define("jquery-mousewheel",["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b)["offsetParent"in a.fn?"offsetParent":"parent"]();return c.length||(c=a("body")),parseInt(c.css("fontSize"),10)},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;
return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),define("backbone",["underscore","jquery","jquery.role","jquery.spin","jquery-mousewheel"],function(a){return function(){var b;return b||a.Backbone}}(this)),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("models/table",["underscore","backbone"],function(b,d){var e,f;return e=function(d){function e(){return this.total=a(this.total,this),this.cnt=a(this.cnt,this),this.portion=a(this.portion,this),this.start=a(this.start,this),this.prevPage=a(this.prevPage,this),this.nextPage=a(this.nextPage,this),this.notLastPage=a(this.notLastPage,this),this.notFirstPage=a(this.notFirstPage,this),this.firstPage=a(this.firstPage,this),this.lastPageStart=a(this.lastPageStart,this),this.lastPage=a(this.lastPage,this),this.extractOrder=a(this.extractOrder,this),f=e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.parse=function(a){return"mergePage"===this.get("fetchType")&&(a.start=""+this.start(),a.cnt=""+(this.cnt()+parseInt(a.cnt,10))),a.columns&&(a.order=this.extractOrder(b.clone(a.columns))),a},e.prototype.extractOrder=function(a,c){var d,e;return null==c&&(c={}),a.length?(e=a.splice(0,1)[0],e.sort&&(d="1"===e.asc?"asc":"1"===e.desc?"desc":void 0,d&&(c[e.id]=d)),e.group&&b.extend(c,this.extractOrder(e.group)),this.extractOrder(a,c)):c},e.prototype.lastPage=function(){return this.start()>=this.total()-this.portion()},e.prototype.lastPageStart=function(){return this.total()-this.total()%this.portion()},e.prototype.firstPage=function(){return!this.start()},e.prototype.notFirstPage=function(){return this.start()>this.portion()},e.prototype.notLastPage=function(){return this.start()+this.cnt()<this.total()-this.portion()+1},e.prototype.nextPage=function(){return this.start()+this.portion()},e.prototype.prevPage=function(){return this.start()-this.portion()},e.prototype.start=function(){return parseInt(this.get("start"),10)},e.prototype.portion=function(){return parseInt(this.get("portion"),10)},e.prototype.cnt=function(){return parseInt(this.get("cnt"),10)},e.prototype.total=function(){return parseInt(this.get("total"),10)},e}(d.Model)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/split_table",["underscore"],function(b){var c;return c=function(){function c(c,d,e,f,g){this._countDims=a(this._countDims,this),this._insertWidthRulers=a(this._insertWidthRulers,this),this._splitTable=a(this._splitTable,this),this._preRender=a(this._preRender,this);var h,i,j,k,l,m,n,o,p;this.container=c,i=$(c).width(),this.tableDefaults=e,k=this._createTable(d),this.model=f,(null!=(o=f.get("calculated_dimensions"))?o.headers:void 0)?k.style.tableLayout="fixed":(k.style.width="100%",k.style.tableLayout="auto"),l=k.querySelector("thead"),l&&g(l,this.model.get("fix_columns")),this._insertWidthRulers(k),p=this._countDims(k),n=p[0],j=p[1],h=p[2],m=b(n).reduce(function(a,b){return a+b},0),this.top=this._splitTable(k.querySelector("thead"),n,j,e.scrollBarWidth),this.bottom=this._splitTable(k.querySelector("tbody"),n,h)}return c.prototype._autoExpandWidths=function(a,c){return b(a).map(function(a){return Math.round(a*c)})},c.prototype._createTable=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.querySelector("table")},c.prototype._preRender=function(){var a,c,d,e,f;return a=document.createElement("div"),a.style.position="fixed",a.style.top="-10000px",a.style.left="-10000px",(null!=(f=this.model.get("calculated_dimensions"))?f.headers:void 0)?(e=b(this.model.get("columns")).map(function(a){return a.width}),d=b(e).reduce(function(a,b){return a+b},0),c=d):c=$(this.container).width(),a.style.width=c+"px",a.style.height="100px",a.style.overflow="hidden",a.className="st-table-pre-render",this.container.appendChild(a),a},c.prototype._splitTable=function(a,c,d,e){var f,g,h,i,j,k,l=this;return null==e&&(e=0),f=0,j=0,k=0,g=null,h=null,a&&(g=document.createElement("table"),g.style.tableLayout="fixed",g.className="st-fixed-table-left",h=g.cloneNode(),h.className="st-fixed-table-right",i=document.createElement("div"),b(a.querySelectorAll("tr")).each(function(a,e){var i,m,n,o,p;return o=a.cloneNode(),p=a.cloneNode(),n=d[e],o.style.height=""+n+"px",p.style.height=""+n+"px",g.appendChild(o),h.appendChild(p),i=0===l.model.get("fix_columns")?!1:!0,f+=n,m=0,b(a.querySelectorAll("td, th")).each(function(b){var d;return"freezbar-cell"!==b.className?("st-table-widths-row"===a.className&&c&&(d=c[m],b.style.width=""+d+"px",m+=1,i?j+=d:k+=d),i?o.appendChild(b.cloneNode(!0)):p.appendChild(b.cloneNode(!0))):i=!1})}),g.style.width=""+j+"px",0!==k&&(i.style.width=""+(k+e+this.tableDefaults.extraWidth)+"px",h.style.width=""+k+"px",h.setAttribute("data-scroll-width",""+e)),i.appendChild(h)),{left:g,right:i,height:f}},c.prototype._insertWidthRulers=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(j=0,i=null,d=0,w=a.querySelector("tr").querySelectorAll("th, td"),g=r=0,u=w.length;u>r;g=++r)b=w[g],"freezbar-cell"===b.className&&(i=g),e=b.colSpan?b.colSpan:1,j+=e;for(o=a.querySelector("thead"),k=a.querySelector("tbody"),o&&(q=o.insertRow(0),q.className="st-table-widths-row"),p=k.insertRow(0),p.className="st-table-widths-row",f=s=0,x=j-1;x>=0?x>=s:s>=x;f=x>=0?++s:--s)c=f===i?"freezbar-cell":(d+=1,"st-table-column-holder st-width-col-"+d),o&&(m=q.insertCell(-1),m.className=c),l=p.insertCell(-1),l.className=c;for(y=a.querySelectorAll("tr"),z=[],t=0,v=y.length;v>t;t++)h=y[t],n=h.insertCell(0),z.push(n.className="st-row-height-td");return z},c.prototype._elWidth=function(a){return Math.max(a.clientWidth,a.offsetWidth,a.scrollWidth)},c.prototype._elHeight=function(a){return Math.max(a.clientHeight,a.offsetHeight,a.scrollHeight)},c.prototype._countDims=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(d=this._preRender(),d.appendChild(a),f=document.documentElement.clientHeight-$(this.container).position().top,h=d.scrollHeight+this.tableDefaults.scrollBarWidth,f>0&&h>f&&f<this.tableDefaults.min_height+this.tableDefaults.scrollBarWidth&&(e=$(this.container.parentElement.parentElement),e.width(e.width()-this.tableDefaults.scrollBarWidth),d.style.width=d.style.width.replace("px","")-this.tableDefaults.scrollBarWidth+"px"),j=[],o=a.querySelector("tr.st-table-widths-row").querySelectorAll("td"),k=0,m=o.length;m>k;k++)c=o[k],"freezbar-cell"!==(p=c.className)&&"st-row-height-td"!==p&&j.push(this._elWidth(c));for(g=function(){var b,c,d,e;for(d=a.querySelector("thead").querySelectorAll("td.st-row-height-td"),e=[],b=0,c=d.length;c>b;b++)i=d[b],e.push(this._elHeight(i));return e}.call(this),b=function(){var b,c,d,e;for(d=a.querySelector("tbody").querySelectorAll("td.st-row-height-td"),e=[],b=0,c=d.length;c>b;b++)i=d[b],e.push(this._elHeight(i));return e}.call(this),q=a.querySelectorAll("td.st-row-height-td"),l=0,n=q.length;n>l;l++)i=q[l],i.parentNode.removeChild(i);return this.container.removeChild(d),[j,g,b]},c}()})}.call(this),function(){define("templates/_sort_block",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='st-sort-block'>\n  <span class='st-sort-btn' data-order-dir='desc' title='сортировать по убыванию'>\n    &#9650;\n  </span>\n  <span class='st-sort-btn' data-order-dir='asc' title='сортировать по возрастанию'>\n    &#9660;\n  </span>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/sorting",["underscore","jquery","backbone","templates/_sort_block"],function(b,c,d){var e;return e=function(){function e(e){this.setSorting=a(this.setSorting,this),this._onClickSort=a(this._onClickSort,this),this._assignHandlers=a(this._assignHandlers,this),b.extend(this,d.Events),this.model=e.model,this.app=e.app,this.$container=c(e.container),this._assignHandlers(),this.setSorting(),this.listenTo(this.model,"change:order",this.setSorting)}return e.prototype._assignHandlers=function(){return this.$container.on("click","[data-order-dir]",this._onClickSort)},e.prototype._onClickSort=function(a){var d,e,f,g,h;return this.app.log("sort click"),d=c(a.currentTarget),g=d.closest("td, th").attr("id"),e=d.data("order-dir"),h={},f=b.clone(this.model.get("order")),(!d.hasClass("active")||b.size(f)>1)&&(h[g]=e),a.ctrlKey?(f[g]=e,this.model.set("order",f)):this.model.set("order",h),this.app.trigger("table:sort")},e.prototype.setSorting=function(){var a=this;return this.$container.find("div.st-sort-block > span[data-order-dir]").removeClass("active"),b(this.model.get("order")).each(function(b,c){return a.$container.find("#"+c+' span[data-order-dir="'+b+'"]').addClass("active")})},e}()})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/resizing_grid",["underscore","jquery"],function(b,c){var d;return d=function(){function d(b){this._getWidthColumns=a(this._getWidthColumns,this),this.resizeHolder=a(this.resizeHolder,this),this.$container=c(b.container),this.model=b.model,this.app=b.app,this.currentBlock=null,this.holder=null}return d.prototype.setGrid=function(){var a,c,d,e=this;return a=this.$container[0],a.contains(this.holder)&&a.removeChild(this.holder),this.holder=this.resizeHolder(),this.widthCols={},c=a.querySelector("table"),this.$container.find("tr .st-table-column-holder").each(function(a,b){var c;return c=b.offsetLeft+e.app.elWidth(b),e.widthCols[c]=b}),this.widthColsKeys=b.keys(this.widthCols),d=this.$container.find("th, td").filter(":not(.st-table-column-holder)"),b(d).each(function(a){var b,d;return b=a.offsetLeft+a.clientWidth,d=e.resizeBlock({left:b,top:a.offsetTop},e.app.elHeight(a)),d._resize={},d._resize.resizeGrid=e,d._resize.tableClass=c.className,d._resize.tdClass=a.className,d._resize.width=a.clientWidth,d._resize.colsClasses=e._getWidthColumns(a),e.holder.appendChild(d)}),a.appendChild(this.holder)},d.prototype.resizeHolder=function(){var a;return a=document.createElement("div"),a.className="st-resize-container",a},d.prototype.resizeBlock=function(a,b){var c;return c=document.createElement("div"),c.className="st-resize-block",c.style.height=""+b+"px",c.style.left=""+a.left+"px",c.style.top=""+a.top+"px",c},d.prototype._getWidthColumns=function(a){var c,d,e,f,g,h,i;for(d=a.offsetLeft,e=this.app.elWidth(a),h=b.filter(this.widthColsKeys,function(a){var b;return d<(b=parseInt(a,10))&&d+e>=b}),i=[],f=0,g=h.length;g>f;f++)c=h[f],i.push(this.widthCols[c].className);return i},d}()})}.call(this),function(){define("templates/_resize_bar",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='st-resizing-bar'></div>\n<div class='st-resizing-drop-bar'></div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/resizing",["underscore","jquery","templates/_resize_bar"],function(b,c,d){var e;return e=function(){function e(b){this._resizeAction=a(this._resizeAction,this),this._resizeBar=a(this._resizeBar,this),this._newWidth=a(this._newWidth,this),this._onMouseUp=a(this._onMouseUp,this),this._onMouseMove=a(this._onMouseMove,this),this._onMouseDown=a(this._onMouseDown,this),this.rebind=a(this.rebind,this),this.app=b.app,this.onResizeCb=b.onResizeCb,this.tableDefaults=b.tableDefaults,this.$main=b.$main,this.mainHeight=this.$main.height(),this.statOverlay=b.statOverlay,this.$main.on("mousedown",".st-resize-block",this._onMouseDown),this.$main.on("mousemove",this._onMouseMove),this.$main.on("mouseup",this._onMouseUp),this.dragging=!1}return e.prototype.rebind=function(a){this.statOverlay=a.statOverlay},e.prototype._onMouseDown=function(a){return this.$current=c(a.currentTarget),this.$current.addClass("dragging"),this.resizeBar=this._resizeBar(a.currentTarget),this.statOverlay.appendChild(this.resizeBar.div),this.startDragX=a.clientX,this.origWidth=this.$current[0]._resize.width,this.numCols=this.$current[0]._resize.colsClasses.length,this.dragging=!0,a.preventDefault(),a.stopPropagation()},e.prototype._onMouseMove=function(a){var b;if(this.dragging)return b=this.resizeBar.initLeft-this.origWidth+this._newWidth(a),this.resizeBar.div.style.left=""+b+"px"},e.prototype._onMouseUp=function(a){var b;if(this.dragging)return b=this._newWidth(a),this.app.log("prev width: "+this.origWidth+" | new width: "+b),this._resizeAction(b,this.$current[0]),this.$current.removeClass("dragging"),this.$current=null,this.statOverlay.removeChild(this.resizeBar.div),this.resizeBar=null,this.startDragX=0,this.origWidth=0,this.dragging=!1,this.app.cancelSelection()},e.prototype._newWidth=function(a){var c;return this.dragging?(c=a.clientX-this.startDragX,b.max([this.tableDefaults.columnMinWidth*this.numCols,this.origWidth+c])):0},e.prototype._resizeBar=function(a){var b,c,e,f,g,h,i,j;return b=document.createElement("div"),b.className="st-resizing-bar-holder",b.innerHTML=d(),h=a.getBoundingClientRect(),i=this.statOverlay.getBoundingClientRect(),j=h.top-i.top,f=h.left-i.left,b.style.top=""+j+"px",b.style.left=""+f+"px",e=b.querySelector(".st-resizing-bar"),g=h.height||h.bottom-h.top,e.style.height=""+g+"px",c=b.querySelector(".st-resizing-drop-bar"),c.style.height=""+this.mainHeight+"px",{div:b,initLeft:f}},e.prototype._resizeAction=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o;for(d=this.$main.find("."+c._resize.tableClass),g=d.eq(0).width(),e=a-c._resize.width,d.each(function(a,b){return b.style.width=""+(g+e)+"px"}),o=this._splitByColumns(a,this.numCols),f=k=0,m=o.length;m>k;f=++k)for(j=o[f],i=this.$main[0].querySelectorAll(this._classToQuery(c._resize.colsClasses[f])),l=0,n=i.length;n>l;l++)h=i[l],h.style.width=""+j+"px";return c._resize.resizeGrid.setGrid(),b.isFunction(this.onResizeCb)?this.onResizeCb.call(null,c._resize.tableClass):void 0},e.prototype._classToQuery=function(a){return("."+a).split(" ").join(".")},e.prototype._splitByColumns=function(a,b){var c,d,e,f,g;for(e=a%b,c=Math.floor(a/b),g=[],d=f=1;b>=1?b>=f:f>=b;d=b>=1?++f:--f)g.push(c+(e>=d?1:0));return g},e}()})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/column_reordering",["underscore","jquery"],function(b,c){var d;return d=function(){function d(b,d){this._scrollSpeed=a(this._scrollSpeed,this),this._scrollHeader=a(this._scrollHeader,this),this._restorePosition=a(this._restorePosition,this),this._savePosition=a(this._savePosition,this),this._insertAfter=a(this._insertAfter,this),this._insertBefore=a(this._insertBefore,this),this._calcTable=a(this._calcTable,this),this._nextEdge=a(this._nextEdge,this),this._unmarkGroup=a(this._unmarkGroup,this),this._markGroup=a(this._markGroup,this),this._getBoundaries=a(this._getBoundaries,this),this.buildHierarchy=a(this.buildHierarchy,this),this._divPos=a(this._divPos,this),this.doDrag=a(this.doDrag,this),this._changedPos=a(this._changedPos,this),this._onMouseUp=a(this._onMouseUp,this),this._onMouseMove=a(this._onMouseMove,this),this._onMouseDown=a(this._onMouseDown,this),b.model.get("disable_reorder_columns")||(this.dragConfig={threshold:10,scrollEdge:50,maxScrollSpeed:50},this.app=b.app,this.el=b.container,this.$el=c(this.el),this.mainViewport=d,this.$el.on("mousedown","th",this._onMouseDown),c(document).on("mousemove",this._onMouseMove),c(document).on("mouseup",this._onMouseUp))}return d.prototype._onMouseDown=function(a){return this.dragEvent?void 0:this.initState={x:a.clientX,y:a.clientY,scrollInit:this.el.scrollLeft,el:a.currentTarget}},d.prototype._onMouseMove=function(a){var c;if(this.initState)return this.dragEvent?(this.polling=!1,this.dragPoll&&clearTimeout(this.dragPoll),this.doDrag(a.clientX)):(Math.abs(this.initState.x-a.clientX)>this.dragConfig.threshold||Math.abs(this.initState.y-a.clientY)>this.dragConfig.threshold)&&(this.app.cancelSelection(),c=this.initState.el,this.dragEvent={initState:b.clone(this.initState),oldPos:{left:c.offsetLeft,top:c.offsetTop},boundaries:this._getBoundaries(c),elWidth:c.offsetWidth,initElBgColor:c.style.backgroundColor,dragDiv:this._dragDiv(this.initState)},this._markGroup(this.dragEvent),this._savePosition(c.nextSibling),this._setDivPos(a,this.dragEvent),this.el.appendChild(this.dragEvent.dragDiv)),a.preventDefault(),a.stopPropagation()},d.prototype._onMouseUp=function(a){return this.initState=null,this.dragEvent?(this.el.contains(a.target)?this._changedPos()&&this.app.trigger("table:reorder"):this._restorePosition(this.dragEvent),this._unmarkGroup(),this.el.removeChild(this.dragEvent.dragDiv),this.app.cancelSelection(),this.dragEvent=null):void 0},d.prototype._changedPos=function(){return"undefined"!=typeof this._prevPosition&&this.dragEvent.initState.el.nextSibling!==this._prevPosition},d.prototype.doDrag=function(a){return this.dragEvent?(this._scrollHeader(a),this._setDivPos(a,this.dragEvent),this._calcTable(this.dragEvent),this.polling?this.dragPoll=setTimeout(this.doDrag,100,a):void 0):void 0},d.prototype._dragDiv=function(a){var b,c,d;return c=a.el,d=c._reorder.boundingRect,b=document.createElement("div"),b.className="st-drag-div",b.style.width=""+(d.right-d.left)+"px",b.style.height=""+(d.bottom-d.top)+"px",b},d.prototype._setDivPos=function(a,b){var c;return c=this._divPos(a,b),b.dragDiv.style.top=""+c.y+"px",b.dragDiv.style.left=""+c.x+"px"},d.prototype._divPos=function(a,c){var d;return d=this.el.scrollLeft-c.initState.scrollInit,a=c.oldPos.left+(a+d-c.initState.x),{y:c.oldPos.top,x:b.min([b.max([a,c.boundaries.left]),c.boundaries.right-c.elWidth])}},d.prototype.buildHierarchy=function(){var a,c,d,e=this;if(this.el)return a=this.el.querySelector("table"),c=a.querySelectorAll("th, td"),d=b(c).map(function(a){return a._reorder=null,{el:a,left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth}}),b(d).each(function(a){var c;return(c=a.el)._reorder||(c._reorder={children:[],parents:[]}),b(d).each(function(b){var c,d,e;return a!==b&&a.left<=b.left&&a.right>=b.right?((c=b.el)._reorder||(c._reorder={children:[],parents:[]}),(d=a.el._reorder.children)[e=b.el.parentElement.getAttribute("data-row-index")]||(d[e]=[]),a.el._reorder.children[b.el.parentElement.getAttribute("data-row-index")].push(b.el),b.el._reorder.parents.push(a.el)):void 0})}),b(c).each(function(a){var c,d;return c=+1/0,d=null,b(a._reorder.parents).each(function(a){return a.offsetWidth<c&&"0"!==a.parentElement.getAttribute("data-row-index")?(c=a.offsetWidth,d=a):void 0}),a._reorder.nearestParent=d}),b(c).each(function(a){var c;return c=e._getRect(a),b(a._reorder.children).each(function(a){return b(a).each(function(a){return c=e._calcRect(c,e._getRect(a))})}),a._reorder.boundingRect=c})},d.prototype._getRect=function(a){return{top:a.offsetTop,left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth,bottom:a.offsetTop+a.offsetHeight}},d.prototype._calcRect=function(a,c){return{top:b.min([a.top,c.top]),left:b.min([a.left,c.left]),right:b.max([a.right,c.right]),bottom:b.max([a.bottom,c.bottom])}},d.prototype._getBoundaries=function(a){var b;return b=a._reorder.nearestParent||this.el.querySelector("table"),{left:b.offsetLeft,right:b.offsetLeft+b.offsetWidth}},d.prototype._markGroup=function(a){var c,d=this;return this.prevState&&this._unmarkGroup(),c=a.initState.el,this.prevState=[],this.prevState.push({el:c,state:this._saveThState(c)}),b(c._reorder.children).each(function(a){return b(a).each(function(a){return d.prevState.push({el:a,state:d._saveThState(a)})})})},d.prototype._unmarkGroup=function(){var a=this;return b(this.prevState).each(function(b){return a._restoreThState(b.el,b.state)}),this.prevState=null},d.prototype._saveThState=function(a){var b;return b=a.style.backgroundColor,a.style.backgroundColor="#ccc",{bg:b}},d.prototype._restoreThState=function(a,b){return a.style.backgroundColor=b.bg},d.prototype._prevEdge=function(a){return a.offsetLeft+a.offsetWidth/2},d.prototype._nextEdge=function(a){return this._prevEdge(a)},d.prototype._calcTable=function(a){var b,c,d,e;return b=a.dragDiv,c=a.initState.el,e=c.previousSibling,d=c.nextSibling,e&&b.offsetLeft<this._prevEdge(e)?this._insertBefore(c,e):d&&b.offsetLeft+b.offsetWidth>this._nextEdge(d)?this._insertAfter(c,d):void 0},d.prototype._insertBefore=function(a,c){var d,e;return e=a.parentNode,d=e.removeChild(a),e.insertBefore(d,c),b(a._reorder.children).each(function(a,d){return b(a).each(function(a){var b,e,f;return f=a.parentNode,b=c?c._reorder.children[d][0]:null,e=f.removeChild(a),f.insertBefore(e,b)})})},d.prototype._insertAfter=function(a,b){return this._insertBefore(a,b.nextSibling)},d.prototype._savePosition=function(a){return this._prevPosition=a||null},d.prototype._restorePosition=function(a){return"undefined"!=typeof this._prevPosition&&this._insertBefore(a.initState.el,this._prevPosition),this._prevPosition=void 0},d.prototype._scrollHeader=function(a){var b,c,d;return c=this.el.getBoundingClientRect(),b=c.left+this.dragConfig.scrollEdge,d=c.right-this.dragConfig.scrollEdge,b>a?(this.el.scrollLeft=this.el.scrollLeft-this._scrollSpeed(b-a),this.mainViewport.scrollLeft=this.el.scrollLeft,this.polling=!0):a>d?(this.el.scrollLeft=this.el.scrollLeft+this._scrollSpeed(a-d),this.mainViewport.scrollLeft=this.el.scrollLeft,this.polling=!0):void 0},d.prototype._scrollSpeed=function(a){return Math.floor(b.max([a,this.dragConfig.scrollEdge])/this.dragConfig.scrollEdge*this.dragConfig.maxScrollSpeed)},d}()})}.call(this),function(){define("templates/main_table",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='st-table-container'>\n  <div class='st-overlay-container'>\n    <div class='st-selection-container'></div>\n    <div class='st-coldrag-container'></div>\n  </div>\n  <div class='st-table-header-left-pane'></div>\n  <div class='st-table-header-right-pane'></div>\n  <div class='st-table-left-viewport'></div>\n  <div class='st-table-right-viewport'></div>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/empty_table",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("No data"),a.join("\n")},b.call(a)}})}.call(this),function(){var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};define("views/table",["underscore","jquery","backbone","services/split_table","services/sorting","services/resizing_grid","services/resizing","services/column_reordering","templates/main_table","templates/empty_table","templates/_sort_block"],function(_,$,Backbone,SplitTable,Sorting,ResizingGrid,Resizing,ColumnReordering,mainTableTemplate,emptyTableTemplate,sortTemplate){var TableView,_ref;
return TableView=function(_super){function TableView(){return this._scrollBarWidth=__bind(this._scrollBarWidth,this),this._setPanesSize=__bind(this._setPanesSize,this),this._getContainerHeight=__bind(this._getContainerHeight,this),this._viewportHeight=__bind(this._viewportHeight,this),this._startSpinner=__bind(this._startSpinner,this),this._stopSpinner=__bind(this._stopSpinner,this),this._assignExtensions=__bind(this._assignExtensions,this),this._renderContainer=__bind(this._renderContainer,this),this._onScroll=__bind(this._onScroll,this),this._resizeCb=__bind(this._resizeCb,this),this._assignRegions=__bind(this._assignRegions,this),_ref=TableView.__super__.constructor.apply(this,arguments)}return __extends(TableView,_super),TableView.prototype.events={"click [data-href]":"_onClickDataHref"},TableView.prototype._onClickDataHref=function(e){var data,el,jscode,parseData,prefix;return e.stopPropagation(),"INPUT"!==e.target.tagName&&"SELECT"!==e.target.tagName?(el=e.currentTarget,data=el.getAttribute("data-href"),(parseData=data.match(/^javascript:(.*)/m))?(prefix=parseData[0],jscode=parseData[1],eval(jscode)):window.location.href=data):void 0},TableView.prototype.initialize=function(){var a,b=this;return this.tableDefaults={columnWidth:120,columnMinWidth:40,borderWidth:1,rowHeight:28,width:0,height:0,extraWidth:0,scrollBarWidth:null,min_height:200},this.app=this.options.app,this.log=this.app.log,this.listenTo(this.options.app,"page:loading",this._startSpinner),this.listenTo(this.options.app,"page:loaded",this._stopSpinner),this.listenTo(this.model,"change",function(a){return a.changed.data?b.render():void 0}),this.prevScrollTop=0,this.prevScrollLeft=0,this._tableRendered=!1,this._regionsAssigned=!1,this._hitBottom=!1,a=_.debounce(function(){return b.tableContainer?(b.tableContainer.style.width="0px",b.tableContainer.style.height="0px",b.$el.width(0),b.$el.height(0),document.body.style.overflow="auto",b._setPanesSize()):void 0},300),$(window).on("resize",function(){return document.body.style.overflow="hidden"}),$(window).on("resize",a)},TableView.prototype.render=function(){var a,b,c;return this.log("render"),this._scrollBarWidth(),a=this.model.get("data"),this._regionsAssigned||(this.$el.html(mainTableTemplate()),this._assignRegions()),a&&this._renderContainer(a),c=this.$el.find("tr.row-state-visited"),c.length&&(b=c.position().top-$(this.tableRightViewport).height()/2,this.tableRightViewport.scrollTop=this.tableLeftViewport.scrollTop=b),this},TableView.prototype.insertSortBlocks=function(a,b){var c;return c=a.querySelectorAll("td.sortable, th.sortable"),_(c).each(function(a){return b?a.style.whiteSpace="nowrap":$(a).append(" "),$(a).append(sortTemplate())})},TableView.prototype.onShow=function(){return this._tableRendered?(this._setPanesSize(),this._stopSpinner()):this.$el.spin()},TableView.prototype._assignRegions=function(){return this._regionsAssigned?void 0:(this.$tableContainer=this.$(".st-table-container"),this.tableContainer=this.$tableContainer[0],this.staticOverlay=this.tableContainer.querySelector(".st-overlay-container"),this.tableRightViewport=this.tableContainer.querySelector(".st-table-right-viewport"),this.tableLeftViewport=this.tableContainer.querySelector(".st-table-left-viewport"),this.headerRightPane=this.tableContainer.querySelector(".st-table-header-right-pane"),this.headerLeftPane=this.tableContainer.querySelector(".st-table-header-left-pane"),this.leftExts=this._assignExtensions(this.headerLeftPane),this.rightExts=this._assignExtensions(this.headerRightPane),this.resizer?this.resizer.rebind({statOverlay:this.staticOverlay}):this.resizer=new Resizing({app:this.app,$main:this.$el,onResizeCb:this._resizeCb,statOverlay:this.staticOverlay,tableDefaults:this.tableDefaults}),this._regionsAssigned=!0)},TableView.prototype._resizeCb=function(a){var b,c,d,e,f,g,h;if("st-fixed-table-left"===a)this._setPanesSize(),this.leftExts.reorder.buildHierarchy();else if("st-fixed-table-right"===a){for(e=this.tableContainer.querySelectorAll(".st-fixed-table-right"),f=0,g=e.length;g>f;f++)d=e[f],c=this.tableDefaults.extraWidth+((h=d.getAttribute("data-scroll-width"))?parseInt(h,10):0),b=d.parentElement,b.style.width=""+(this.app.elWidth(d)+c)+"px";this.rightExts.reorder.buildHierarchy()}return this.app.trigger("table:widths")},TableView.prototype._onScroll=function(){var a,b,c,d;if(this.tableRightViewport&&(b=this.tableRightViewport.scrollLeft,c=this.tableRightViewport.scrollTop,a=Math.abs(b-this.prevScrollLeft),d=Math.abs(c-this.prevScrollTop),this.prevScrollLeft=b,this.prevScrollTop=c,a&&(this.headerRightPane.scrollLeft=b),d)){if(this.tableLeftViewport.scrollTop=c,c+this.tableRightViewport.clientHeight>=this.tableRightViewport.scrollHeight)return this.options.app.trigger("scroll:bottom"),this._hitBottom=!0;if(this._hitBottom)return this.options.app.trigger("scroll"),this._hitBottom=!1}},TableView.prototype._renderContainer=function(a){var b,c=this;if(a)return this.log("render container"),this._startSpinner(),b=new SplitTable(this.el,a,this.tableDefaults,this.model,this.insertSortBlocks),this._numerateRows(b.top.left),this._numerateRows(b.top.right),this.log("insert header"),b.top.left&&(this.headerLeftPane.innerHTML="",this.headerLeftPane.appendChild(b.top.left),this.headerLeftColumns=this.headerLeftPane.querySelector("table"),this.leftExts.reset()),b.top.right&&(this.headerRightPane.innerHTML="",b.top.right&&this.headerRightPane.appendChild(b.top.right),this.headerRightColumns=this.headerRightPane.querySelector("table"),this.headerHeight=b.top.height,this.rightExts.reset()),this.log("insert data"),"page"===this.model.get("fetchType")&&(this.tableLeftViewport.innerHTML="",this.tableRightViewport.innerHTML=""),this.tableLeftViewport.appendChild(b.bottom.left),this.tableRightViewport.appendChild(b.bottom.right),this.tableRightViewport.onscroll=this._onScroll,$(this.tableLeftViewport).off("mousewheel"),$(this.tableLeftViewport).on("mousewheel",function(a){return a.deltaY&&(c.tableRightViewport.scrollTop-=a.deltaY*a.deltaFactor),c._onScroll()}),this._tableRendered=!0,this._tables=b,this.app.trigger("container:render"),this._setPanesSize(),this._stopSpinner()},TableView.prototype._numerateRows=function(a,b){var c;return null==b&&(b=0),c=null!=a?a.querySelectorAll("tr"):void 0,_(c).each(function(a,c){return a.setAttribute("data-row-index",c+b)})},TableView.prototype._assignExtensions=function(a){var b;return b={app:this.options.app,model:this.model,container:a},{sort:new Sorting(b),resize:new ResizingGrid(b),reorder:new ColumnReordering(b,this.tableRightViewport),reset:function(){return this.sort.setSorting(),this.resize.setGrid(),this.reorder.buildHierarchy()}}},TableView.prototype._stopSpinner=function(){return this.$el.spin(!1)},TableView.prototype._startSpinner=function(){return this.$el.spin(!0)},TableView.prototype._viewportHeight=function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},TableView.prototype._getContainerHeight=function(a){var b,c,d,e,f,g;return e=$(a.top.right).height(),b=$(a.bottom.right).height(),g=this._scrollBarWidth(),c=e+b+g,d=this._viewportHeight()-this.$el.position().top,d-=this.$el.css("padding-top").replace("px",""),d-=this.$el.css("padding-bottom").replace("px",""),f=this.tableDefaults.min_height+g,d>c?c:d>f?d:c},TableView.prototype._setPanesSize=function(){var a,b,c,d,e;return this.containerWidth=this.$el.width(),this.$el.height(this._getContainerHeight(this._tables)),this.containerHeight=this.$el.height(),this.log("set panes size"),this.log("setting sizes for width: "+this.containerWidth+", height: "+this.containerHeight),this.tableDefaults.width=this.containerWidth,this.tableDefaults.height=this.containerHeight,this.leftWidth=this.app.elWidth(this.headerLeftColumns),this.rightWidth=this.app.elWidth(this.headerRightColumns),e=this._scrollBarWidth(),a=this.tableDefaults.borderWidth,d=this.containerWidth-this.leftWidth,c=this.containerHeight-this.headerHeight,this.tableContainer.style.width=""+this.containerWidth+"px",this.tableContainer.style.height=""+this.containerHeight+"px",b=this.headerLeftPane.offsetWidth-this.headerLeftPane.clientWidth,this.leftWidth+=b,this.headerLeftPane.style.width=""+this.leftWidth+"px",this.headerRightPane.style.left=""+this.leftWidth+"px",this.headerRightPane.style.width=""+d+"px",this.tableLeftViewport.style.top=""+this.headerHeight+"px",this.tableLeftViewport.style.width=""+this.leftWidth+"px",this.tableLeftViewport.style.height=""+c+"px",this.tableRightViewport.style.top=""+this.headerHeight+"px",this.tableRightViewport.style.left=""+this.leftWidth+"px",this.tableRightViewport.style.width=""+d+"px",this.tableRightViewport.style.height=""+c+"px",this.model.get("fix_columns")?void 0:this.tableRightViewport.style.overflowX="auto"},TableView.prototype._scrollBarWidth=function(){var a,b;return null!==this.tableDefaults.scrollBarWidth?this.tableDefaults.scrollBarWidth:(a=document.createElement("div"),a.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',a=a.firstChild,document.body.appendChild(a),b=a.offsetWidth-a.clientWidth,document.body.removeChild(a),this.tableDefaults.scrollBarWidth=b)},TableView}(Backbone.View)})}.call(this),function(){define("templates/header",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<a class='st-btn' href='#' role='first-page' title='Первая страница'>\n  <strong>&lt;&lt;</strong>\n</a>\n<a class='st-btn' href='#' role='prev-page' title='Предыдущая страница'>\n  <strong>&lt;</strong>\n</a>\n<span role='first-row'>?</span>\n-\n<span role='last-row'>?</span>\nиз\n<span role='total-rows'>?</span>\n<a class='st-btn' href='#' role='next-page' title='Следующая страница'>\n  <strong>&gt;</strong>\n</a>\n<a class='st-btn' href='#' role='last-page' title='Последняя страница'>\n  <strong>&gt;&gt;</strong>\n</a>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/empty_header",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a,b;return a=function(a){switch(a){case null:case void 0:return"";case!0:case!1:return""+a;default:return a}},b=[],b.push("<div class='disabled st-btn'>"+a(this.msg||"список пуст")+"</div>"),b.join("\n").replace(/\s([\w-]+)='true'/gm," $1").replace(/\s([\w-]+)='false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("views/header",["backbone","templates/header","templates/empty_header"],function(b,d,e){var f,g;return f=function(b){function f(){return this.enableFirst=a(this.enableFirst,this),this.enablePrev=a(this.enablePrev,this),this.disableFirst=a(this.disableFirst,this),this.disablePrev=a(this.disablePrev,this),this.enableLast=a(this.enableLast,this),this.enableNext=a(this.enableNext,this),this.disableLast=a(this.disableLast,this),this.disableNext=a(this.disableNext,this),this.renderBindVals=a(this.renderBindVals,this),this.render=a(this.render,this),g=f.__super__.constructor.apply(this,arguments)}return c(f,b),f.prototype.events={"click @more-button":"_onClickMore","click @next-page":"_onClickNext","click @prev-page":"_onClickPrev","click @first-page":"_onClickFirst","click @last-page":"_onClickLast"},f.prototype.initialize=function(){var a=this;return this.listenTo(this.model,"change",this.render),this.listenTo(this.options.app,"scroll:bottom",function(){return a.model.lastPage()?void 0:a._enableMore()}),this.listenTo(this.options.app,"scroll",this._disableMore)},f.prototype.render=function(){return this.model.get("pager_off")?this.$el.hide():(this.$el.show(),parseInt(this.model.get("cnt"),10)>0?(this.$el.html(d()),this._assignUi(),this.renderBindVals()):this.$el.html(e({msg:this.model.get("empty_label")}))),this},f.prototype.renderBindVals=function(){return this.$firstRow.html(this.model.start()+1||"?"),this.$lastRow.html(this.model.start()+this.model.cnt()||"?"),this.$totalRows.html(this.model.total()||"?"),this.model.firstPage()?this.disablePrev():this.enablePrev(),this.model.notFirstPage()?this.enableFirst():this.disableFirst(),this.model.lastPage()?this.disableNext():this.enableNext(),this.model.notLastPage()?this.enableLast():this.disableLast()},f.prototype._assignUi=function(){return this.$moreButton=this.$("@more-button"),this.$nextPage=this.$("@next-page"),this.$prevPage=this.$("@prev-page"),this.$firstPage=this.$("@first-page"),this.$lastPage=this.$("@last-page"),this.$firstRow=this.$("@first-row"),this.$lastRow=this.$("@last-row"),this.$totalRows=this.$("@total-rows")},f.prototype._preventDefault=function(a){return a.preventDefault(),a.stopPropagation(),!1},f.prototype._onClickMore=function(a){return this._preventDefault(a),this.$moreButton.hasClass("disabled")?void 0:(this._disableMore(),this.options.app.trigger("more-button:click"),!1)},f.prototype._onClickNext=function(a){return this._preventDefault(a),this.$nextPage.hasClass("disabled")?void 0:(this.options.app.trigger("next-page:click"),!1)},f.prototype._onClickPrev=function(a){return this._preventDefault(a),this.$prevPage.hasClass("disabled")?void 0:(this.options.app.trigger("prev-page:click"),!1)},f.prototype._onClickLast=function(a){return this._preventDefault(a),this.$lastPage.hasClass("disabled")?void 0:(this.options.app.trigger("last-page:click"),!1)},f.prototype._onClickFirst=function(a){return this._preventDefault(a),this.$firstPage.hasClass("disabled")?void 0:(this.options.app.trigger("first-page:click"),!1)},f.prototype._disableMore=function(){return this.$moreButton.addClass("disabled")},f.prototype._enableMore=function(){return this.$moreButton.removeClass("disabled")},f.prototype.disableNext=function(){return this.$nextPage.hide()},f.prototype.disableLast=function(){return this.$lastPage.hide()},f.prototype.enableNext=function(){return this.$nextPage.show()},f.prototype.enableLast=function(){return this.$lastPage.show()},f.prototype.disablePrev=function(){return this.$prevPage.hide()},f.prototype.disableFirst=function(){return this.$firstPage.hide()},f.prototype.enablePrev=function(){return this.$prevPage.show()},f.prototype.enableFirst=function(){return this.$firstPage.show()},f}(b.View)})}.call(this),function(){define("templates/layout",["jquery","underscore"],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='main-container'>\n  <div class='table-header' role='header' style='display:none'></div>\n  <div class='table-container' role='table-container'></div>\n  <div class='table-footer' role='footer'></div>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("views/layout",["backbone","views/table","views/header","templates/layout"],function(a,c,d,e){var f,g;return f=function(a){function f(){return g=f.__super__.constructor.apply(this,arguments)}return b(f,a),f.prototype.render=function(){return this.$el.empty(),this.$el.html(e()),new d({el:this.$el.parent().prev().find("@header"),app:this.options.app,model:this.options.table}).render(),this.table=new c({el:this.$("@table-container"),app:this.options.app,model:this.options.table,$container:this.$el}),this.table.render()},f}(a.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/table_state",["underscore","backbone"],function(b){var c;return c=function(){function c(b){this.app=b.app,this.el=b.el,this.table=b.table,this._gatherData=a(this._gatherData,this),this._collectHeaderData=a(this._collectHeaderData,this),this.columns=a(this.columns,this),this.columnsStr=a(this.columnsStr,this)}return c.prototype.columnsStr=function(){return JSON.stringify(this.columns())},c.prototype.columns=function(){var a,b;return a=this.el.querySelector(".st-table-container .st-table-header-left-pane table.st-fixed-table-left"),b=this.el.querySelector(".st-table-container .st-table-header-right-pane table.st-fixed-table-right"),[].concat(this._collectHeaderData(a)).concat(this._collectHeaderData(b))},c.prototype._collectHeaderData=function(a){var c,d;return c=a.querySelectorAll("th[id], td[id]"),d=b(c).map(function(a){return{el:a,left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth}}),this._gatherData(d)},c.prototype._gatherData=function(a,c){var d,e,f,g,h;return null==c&&(c=[]),a.length?(e=a.splice(0,1)[0],g=this._tdAttrs(e.el),f=b.partial(this._isChild,e),d=b(a).filter(f),h=b(a).reject(f),d.length&&(g.group=this._gatherData(d,[])),c.push(g),this._gatherData(h,c)):c},c.prototype._isChild=function(a,b){return b.left>=a.left&&b.right<=a.right},c.prototype._tdAttrs=function(a){var c;return c={},a.className.match(/\bsortable\b/)&&(c.sort="1",a.querySelector('div.st-sort-block span[data-order-dir="asc"]').className.match(/\bactive\b/)?c.asc="1":a.querySelector('div.st-sort-block span[data-order-dir="desc"]').className.match(/\bactive\b/)&&(c.desc="1")),b.extend({id:a.id,width:a.clientWidth,height:a.clientHeight},c)},c}()})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define("services/table_api",["underscore","backbone"],function(b,c){var d;return d=function(){function d(d){this._saveState=a(this._saveState,this),this._fetchPage=a(this._fetchPage,this),this._withDefaults=a(this._withDefaults,this),this.postPage=a(this.postPage,this),this.getPage=a(this.getPage,this);var e,f=this;b.extend(this,c.Events),this.app=d.app,this.log=this.app.log,e=d.tableState,this.listenTo(d.app,"more-button:click",function(){return f.table.lastPage()?void 0:f.getPage(f.table.nextPage(),"mergePage")}),this.listenTo(d.app,"next-page:click",function(){return f.table.lastPage()?void 0:f.getPage(f.table.nextPage())}),this.listenTo(d.app,"prev-page:click",function(){return f.table.firstPage()?void 0:f.getPage(f.table.prevPage())}),this.listenTo(d.app,"first-page:click",function(){return f.table.firstPage()?void 0:f.getPage(f.table.firstPage())}),this.listenTo(d.app,"last-page:click",function(){return f.table.lastPage()?void 0:f.getPage(f.table.lastPageStart())}),this.listenTo(d.app,"table:sort",function(){return f.postPage({action:"update_columns",sort:1,columns:e.columnsStr(),salt:Math.random()})}),this.listenTo(d.app,"table:reorder",function(){return f.postPage({action:"update_columns",order:1,columns:e.columnsStr(),salt:Math.random()})}),this.listenTo(d.app,"table:widths",function(){return f._saveState({data:{action:"update_dimensions",columns:e.columnsStr(),salt:Math.random()}})}),this.listenTo(d.app,"container:render",function(){return d.containerRender(f.table)}),this.pageUrl=d.pageUrl,this.table=d.table}return d.prototype.getPage=function(a,b){return null==a&&(a=0),null==b&&(b="page"),this._fetchPage({data:{start:a},fetchType:b})},d.prototype.postPage=function(a){return this._fetchPage({data:a,method:"POST"})},d.prototype._withDefaults=function(a){var c;return c=b.extend({start:this.table.start()||0},a.data,this.table.get("datasource_params")),b.extend({},{data:c,fetchType:"page",method:"GET"},b.omit(a,"data"))},d.prototype._fetchPage=function(a){var b=this;return a=this._withDefaults(a),this.log("fetching page"),this.table.set("fetchType",a.fetchType),this.app.trigger("page:loading"),this.table.fetch({url:this._apiUrl(a.data.start),data:a.data,method:a.method,success:function(){return b.app.trigger("page:loaded")},error:function(){return alert("Ошибка при загрузке страницы")},dataType:"json"})},d.prototype._saveState=function(a){return a=this._withDefaults(a),c.$.ajax({method:"POST",url:this.table.url,data:a.data})},d.prototype._apiUrl=function(a){return this.table.url.replace("#{page}",a)+"&salt="+Math.random()},d}()})}.call(this),function(){define("app",["underscore","backbone","models/table","views/layout","services/table_state","services/table_api"],function(a,b,c,d,e,f){var g;return g=function(){function g(h){var i,j,k,l,m;return a.extend(this,b.Events),this.log("app starting version "+g.version+"..."),h.tableUrl?(i=h.el||"body",k=new c(h.initial_data||{},{url:h.tableUrl}),j=new d({app:this,el:i,table:k}),j.render(),m=new e({app:this,table:k,el:j.table.el}),l=new f({app:this,table:k,tableState:m,pageUrl:h.pageUrl,containerRender:h.containerRender||function(){}}),this.trigger("page:loaded"),void this.trigger("container:render")):(this.log("url is a mandatory parameter"),!1)}return g.version="0.1.4",g.prototype.log=function(a){var b;return null!=(b=window.console)&&"function"==typeof b.log?b.log(a):void 0},g.prototype.elWidth=function(a){return Math.max(a.clientWidth,a.offsetWidth,a.scrollWidth)},g.prototype.elHeight=function(a){return Math.max(a.clientHeight,a.offsetHeight,a.scrollHeight)},g.prototype.cancelSelection=function(){if(document.selection)return document.selection.empty();if(window.getSelection)try{return window.getSelection().collapseToStart()}catch(a){}},g}()})}.call(this),function(){"use strict";require.config({baseUrl:"scripts",shim:{"jquery.role":["jquery"],"jquery-mousewheel":["jquery"],underscore:{exports:"_"},backbone:{deps:["underscore","jquery","jquery.role","jquery.spin","jquery-mousewheel"],exports:"Backbone"}},paths:{jquery:"../bower_components/jquery/jquery","jquery-mousewheel":"../bower_components/jquery-mousewheel/jquery.mousewheel","jquery.role":"../bower_components/rolejs/lib/jquery.role",spin:"../bower_components/spinjs/spin","jquery.spin":"../bower_components/spinjs/jquery.spin",backbone:"../bower_components/backbone/backbone",underscore:"../bower_components/underscore/underscore"}}),define("main",["app"],function(a){return a})}.call(this),define(["main"],function(a){return a})}).call(this);
//# sourceMappingURL=dist/application.js.map